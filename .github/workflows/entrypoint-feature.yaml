name: Entrypoint feature
run-name: Entrypoint feature by @${{ github.actor }}

on:
  pull_request:
    branches: [main]

jobs:
  run-mypy-and-pytest:
    name: Run mypy and pytest
    uses: ./.github/workflows/reusable-test-poetry-package.yaml
    with:
      working-directory: src  # Set working directory for the test workflow
    secrets: inherit

  get-files-with-changes:
    name: Get Files with changes
    uses: ./.github/workflows/reusable-get-files-with-changes.yaml
    with:
      working-directory: src  # Set working directory for detecting file changes

  check-if-application-version-is-bumped:
    name: Check if the application files have changed and version is bumped
    needs: get-files-with-changes
    if: needs.get-files-with-changes.outputs.changed-files != '[]'
    uses: ./.github/workflows/reusable-check-package-version-bumping.yaml
    with:
      working-directory: src  # Set working directory for the version check
    secrets: inherit
    
  deploy-docker-image-to-dev:
    name: Deploy Docker Image to Development
    needs: [get-files-with-changes, run-mypy-and-pytest, check-if-application-version-is-bumped]
    if: needs.get-files-with-changes.outputs.changed-files != '[]' &&
      !failure() &&
      !cancelled()
    uses: ./.github/workflows/reusable-build-deploy-docker-image.yaml
    with:
      environment: development
      stage: dev
      working-directory: src  # Set working directory for Docker build
    secrets: inherit
